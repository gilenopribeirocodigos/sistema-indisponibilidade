<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Opera√ß√µes</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/registro_v2.css">
</head>
<body>
    <div class="registro-container">
        <!-- Header -->
        <div class="header-registro">
            <a href="/home" class="btn-voltar">‚Üê Voltar</a>
            <h1>üìã Registro de Opera√ß√µes</h1>
            <div class="user-info-mini">
                <span>{{ usuario.nome }}</span>
                <span class="badge badge-{{ usuario.perfil.lower() }}">{{ usuario.perfil }}</span>
                <br>
                <small>Supervis√£o: {{ usuario.base_responsavel or "Todas" }}</small>
            </div>
        </div>

        <!-- Mensagens -->
        {% if erro %}
        <div class="alert alert-erro">‚ùå {{ erro }}</div>
        {% endif %}
        
        {% if sucesso %}
        <div class="alert alert-sucesso">‚úÖ {{ sucesso }}</div>
        {% endif %}

        <!-- Seletor de Data -->
        <div class="data-selector">
            <div class="data-header">
                <label for="data-registro">üìÖ Data do Registro:</label>
                <input 
                    type="date" 
                    id="data-registro" 
                    name="data-registro"
                    value="{{ data_selecionada }}"
                    max="{{ hoje_iso }}"
                >
                <span class="data-info">Mostrando eletricistas dispon√≠veis para esta data</span>
            </div>
        </div>

        <!-- Seletor de Tipo (3 bot√µes) -->
        <div class="tipo-selector">
            <button class="tipo-btn active" data-tipo="frequencia">
                <span class="tipo-icon">üìä</span>
                <span class="tipo-label">Frequ√™ncia</span>
                <span class="tipo-desc">Montar equipes do dia</span>
            </button>
            <button class="tipo-btn" data-tipo="remanejado">
                <span class="tipo-icon">üîÑ</span>
                <span class="tipo-label">Remanejar</span>
                <span class="tipo-desc">Pegar eletricista emprestado</span>
            </button>
            <button class="tipo-btn" data-tipo="indisponivel">
                <span class="tipo-icon">‚ö†Ô∏è</span>
                <span class="tipo-label">Indispon√≠vel</span>
                <span class="tipo-desc">Registrar prefixo parado</span>
            </button>
        </div>

        <!-- ========================================
             SE√á√ÉO 1: FREQU√äNCIA
        ======================================== -->
        <div id="secao-frequencia" class="secao-operacao active">
            <div class="form-section">
                <h3>üìä Controle de Frequ√™ncia</h3>
                <p class="section-subtitle">
                    Selecione os eletricistas presentes e associe aos prefixos. 
                    <strong>Total: {{ eletricistas|length }} eletricista(s)</strong>
                </p>
                
                <!-- Lista de eletricistas com checkbox -->
                <div class="eletricistas-grid">
                    {% for elet in eletricistas %}
                    <div class="eletricista-card" data-id="{{ elet.id }}">
                        <input 
                            type="checkbox" 
                            id="elet-{{ elet.id }}" 
                            class="eletricista-checkbox"
                            data-nome="{{ elet.colaborador }}"
                            data-matricula="{{ elet.matricula }}"
                            data-prefixo="{{ elet.prefixo }}"
                            data-base="{{ elet.base }}"
                        >
                        <label for="elet-{{ elet.id }}">
                            <div class="elet-nome">{{ elet.colaborador }}</div>
                            <div class="elet-info">
                                <span>Mat: {{ elet.matricula }}</span>
                                <span>{{ elet.prefixo }}</span>
                            </div>
                        </label>
                    </div>
                    {% endfor %}
                </div>

                <!-- Painel de associa√ß√£o -->
                <div class="associacao-panel">
                    <div class="associacao-header">
                        <h4>Eletricista Selecionado:</h4>
                        <div id="eletricista-info" class="info-vazia">
                            Selecione um eletricista acima
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="prefixo-frequencia">Prefixo da Equipe:</label>
                        <input 
                            type="text" 
                            id="prefixo-frequencia" 
                            placeholder="Digite ou selecione..."
                            list="prefixos-lista"
                        >
                        <datalist id="prefixos-lista">
                            {% for prefixo in prefixos_supervisor %}
                            <option value="{{ prefixo }}">
                            {% endfor %}
                        </datalist>
                        <small class="help-text">Sistema sugere o prefixo, mas voc√™ pode alterar</small>
                    </div>
                    
                    <button id="btn-associar" class="btn btn-primary btn-lg" disabled>
                        ‚úÖ Associar ao Prefixo
                    </button>
                </div>

                <!-- Lista de associa√ß√µes tempor√°rias -->
                <div id="associacoes-temporarias" style="display:none;">
                    <h4>üìã Associa√ß√µes Pendentes de Salvamento:</h4>
                    <div id="lista-associacoes"></div>
                    <div class="acoes-finais">
                        <button id="btn-limpar-todas" class="btn btn-secondary">
                            üóëÔ∏è Limpar Todas
                        </button>
                        <button id="btn-salvar-frequencia" class="btn btn-success btn-lg">
                            üíæ Salvar Todas as Associa√ß√µes
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- ========================================
             SE√á√ÉO 2: REMANEJADO
        ======================================== -->
        <div id="secao-remanejado" class="secao-operacao">
            <div class="form-section">
                <h3>üîÑ Remanejar Eletricista</h3>
                <p class="section-subtitle">
                    Busque um eletricista de outra supervis√£o para usar temporariamente
                </p>
                
                <div class="form-group">
                    <label for="busca-remanejar">Buscar Eletricista:</label>
                    <input 
                        type="text" 
                        id="busca-remanejar"
                        placeholder="Digite o nome do eletricista..."
                        autocomplete="off"
                    >
                    <small class="help-text">Digite ao menos 3 letras</small>
                </div>
                
                <div id="resultado-busca-remanejar" class="resultado-busca"></div>
            </div>
        </div>

        <!-- ========================================
             SE√á√ÉO 3: INDISPON√çVEL
        ======================================== -->
        <div id="secao-indisponivel" class="secao-operacao">
            <div class="form-section">
                <h3>‚ö†Ô∏è Registrar Indisponibilidade</h3>
                <p class="section-subtitle">
                    Registre um eletricista e prefixo como indispon√≠vel
                </p>
                
                <form id="form-indisponivel">
                    <div class="form-group">
                        <label for="eletricista-indisponivel">Eletricista: *</label>
                        <input 
                            type="text" 
                            id="eletricista-indisponivel"
                            name="eletricista"
                            placeholder="Digite o nome..."
                            autocomplete="off"
                            required
                        >
                        <input type="hidden" id="eletricista-id-indisponivel" name="eletricista_id">
                    </div>
                    
                    <div class="form-group">
                        <label for="prefixo-indisponivel">Prefixo: *</label>
                        <input 
                            type="text" 
                            id="prefixo-indisponivel"
                            name="prefixo"
                            placeholder="Ex: PI-AGB-C001M"
                            required
                        >
                    </div>
                    
                    <div class="form-group">
                        <label for="motivo-indisponivel">Motivo: *</label>
                        <select id="motivo-indisponivel" name="motivo_id" required>
                            <option value="">Selecione o motivo...</option>
                            {% for motivo in motivos %}
                            <option value="{{ motivo.id }}">{{ motivo.descricao }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="observacoes-indisponivel">Observa√ß√µes:</label>
                        <textarea 
                            id="observacoes-indisponivel"
                            name="observacoes" 
                            rows="3"
                            placeholder="Informa√ß√µes adicionais..."
                        ></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary btn-lg">
                        ‚ö†Ô∏è Registrar Indisponibilidade
                    </button>
                </form>
            </div>
        </div>

        <!-- Rodap√© -->
        <div class="footer-registro">
            <p>Sistema de Indisponibilidade - DPL Constru√ß√µes | Equatorial Energia</p>
            <p>Data: {{ hoje }} | Usu√°rio: {{ usuario.nome }}</p>
        </div>
    </div>

    <script src="/static/js/registro_v2.js?v={{ now().timestamp() }}"></script>
</body>

</html>

