<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% if usuario_edicao %}Editar{% else %}Novo{% endif %} Usu√°rio</title>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/usuarios.css">
</head>
<body>
    <div class="usuarios-container">
        <!-- Header -->
        <div class="header-usuarios">
            <a href="/usuarios" class="btn-voltar">‚Üê Voltar</a>
            <h1>{% if usuario_edicao %}‚úèÔ∏è Editar Usu√°rio{% else %}‚ûï Novo Usu√°rio{% endif %}</h1>
        </div>

        <!-- Mensagens -->
        {% if erro %}
        <div class="alert alert-erro">‚ùå {{ erro }}</div>
        {% endif %}

        <!-- Formul√°rio -->
        <div class="form-card">
            <form method="POST" id="form-usuario">
                
                <!-- Nome -->
                <div class="form-group">
                    <label for="nome">Nome Completo: *</label>
                    <input 
                        type="text" 
                        id="nome" 
                        name="nome" 
                        value="{{ usuario_edicao.nome if usuario_edicao else '' }}"
                        placeholder="Ex: Jo√£o Silva"
                        required
                    >
                </div>

                <!-- Login -->
                <div class="form-group">
                    <label for="login">Login (usu√°rio): *</label>
                    <input 
                        type="text" 
                        id="login" 
                        name="login" 
                        value="{{ usuario_edicao.login if usuario_edicao else '' }}"
                        placeholder="Ex: joao.silva"
                        {% if usuario_edicao %}readonly{% endif %}
                        required
                    >
                    {% if usuario_edicao %}
                    <small class="help-text">O login n√£o pode ser alterado</small>
                    {% endif %}
                </div>

                <!-- Senha (apenas para novo) -->
                {% if not usuario_edicao %}
                <div class="form-group">
                    <label for="senha">Senha: *</label>
                    <input 
                        type="password" 
                        id="senha" 
                        name="senha" 
                        placeholder="M√≠nimo 6 caracteres"
                        minlength="6"
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="senha_confirmacao">Confirmar Senha: *</label>
                    <input 
                        type="password" 
                        id="senha_confirmacao" 
                        name="senha_confirmacao" 
                        placeholder="Digite a senha novamente"
                        minlength="6"
                        required
                    >
                </div>
                {% endif %}

                <!-- Perfil -->
                <div class="form-group">
                    <label for="perfil">Perfil de Acesso: *</label>
                    <select id="perfil" name="perfil" required>
                        <option value="">Selecione...</option>
                        <option value="admin" {% if usuario_edicao and usuario_edicao.perfil == 'admin' %}selected{% endif %}>
                            üëë ADMIN (acesso total ao sistema)
                        </option>
                        <option value="superv_campo" {% if usuario_edicao and usuario_edicao.perfil == 'superv_campo' %}selected{% endif %}>
                            üë®‚Äçüíº Supervisor de Campo (gerencia equipes)
                        </option>
                        <option value="superv_operacao" {% if usuario_edicao and usuario_edicao.perfil == 'superv_operacao' %}selected{% endif %}>
                            üë®‚Äçüíª Supervisor de Opera√ß√£o (acompanhamento)
                        </option>
                        <option value="visualizador" {% if usuario_edicao and usuario_edicao.perfil == 'visualizador' %}selected{% endif %}>
                            üëÄ Visualizador (apenas consulta)
                        </option>
                    </select>
                    <small class="help-text">
                        <strong>ADMIN:</strong> Acesso total | 
                        <strong>Superv. Campo:</strong> Registra opera√ß√µes | 
                        <strong>Superv. Opera√ß√£o:</strong> Acompanha | 
                        <strong>Visualizador:</strong> Somente l√™
                    </small>
                </div>

                <!-- Base Respons√°vel -->
                <div class="form-group">
                    <label for="base_responsavel">Base/Supervis√£o Respons√°vel:</label>
                    <input 
                        type="text" 
                        id="base_responsavel" 
                        name="base_responsavel" 
                        value="{{ usuario_edicao.base_responsavel if usuario_edicao else '' }}"
                        placeholder="Ex: NAILTON, AFRANCISCO, JOSELITO, CHRISLEY"
                        list="supervisores-lista"
                    >
                    <datalist id="supervisores-lista">
                        {% for sup in supervisores %}
                        <option value="{{ sup }}">
                        {% endfor %}
                    </datalist>
                    <small class="help-text">
                        Digite "Todas" para ADMIN. Para Supervisores, informe o nome da supervis√£o.<br>
                        Supervis√µes dispon√≠veis: NAILTON, AFRANCISCO, JOSELITO, CHRISLEY
                    </small>
                </div>

                <!-- Status -->
                <div class="form-group">
                    <label>
                        <input 
                            type="checkbox" 
                            name="ativo" 
                            {% if not usuario_edicao or usuario_edicao.ativo %}checked{% endif %}
                        >
                        Usu√°rio ativo (pode fazer login)
                    </label>
                </div>

                <!-- Bot√µes -->
                <div class="form-actions">
                    <a href="/usuarios" class="btn btn-secondary">
                        Cancelar
                    </a>
                    <button type="submit" class="btn btn-primary btn-lg">
                        {% if usuario_edicao %}üíæ Salvar Altera√ß√µes{% else %}‚ûï Criar Usu√°rio{% endif %}
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Validar senhas iguais (apenas para novo usu√°rio)
        {% if not usuario_edicao %}
        document.getElementById('form-usuario').addEventListener('submit', function(e) {
            const senha = document.getElementById('senha').value;
            const confirmacao = document.getElementById('senha_confirmacao').value;
            
            if (senha !== confirmacao) {
                e.preventDefault();
                alert('‚ùå As senhas n√£o coincidem!');
                return false;
            }
        });
        {% endif %}
    </script>
</body>
</html>
